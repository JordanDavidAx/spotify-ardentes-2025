<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify x Ardentes 2025</title>
    <style>
        :root {
            --spotify-green: #1DB954;
            --ardentes-orange: #FF6B35;
            --ardentes-red: #E63946;
            --dark-bg: #191414;
            --card-bg: #282828;
            --text-light: #FFFFFF;
            --text-muted: #B3B3B3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #191414 0%, #333 50%, #FF6B35 100%);
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        header h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--spotify-green), var(--ardentes-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .github-badge {
            background: var(--spotify-green);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
        }

        .section {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
        }

        .hidden {
            display: none !important;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            max-width: 800px;
            width: 100%;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--spotify-green), var(--ardentes-orange), var(--ardentes-red));
            border-radius: 22px;
            z-index: -1;
        }

        .setup-step {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .step-number {
            background: var(--spotify-green);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-content {
            display: inline-block;
            vertical-align: top;
            width: calc(100% - 50px);
        }

        .url-display {
            background: var(--dark-bg);
            border: 1px solid var(--spotify-green);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--spotify-green);
            word-break: break-all;
            cursor: pointer;
        }

        .client-id-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--spotify-green);
            border-radius: 10px;
            background: var(--dark-bg);
            color: var(--text-light);
            font-family: monospace;
            font-size: 1rem;
            margin: 15px 0;
        }

        .spotify-btn {
            background: var(--spotify-green);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            margin: 20px 0;
        }

        .spotify-btn:hover {
            background: #1ed760;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(29, 185, 84, 0.3);
        }

        .spotify-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--text-muted);
            border-top: 4px solid var(--spotify-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--spotify-green);
            background: var(--spotify-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--spotify-green);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .artists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .artist-match {
            background: linear-gradient(135deg, var(--spotify-green), var(--ardentes-orange));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .artist-match:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .no-matches {
            grid-column: 1/-1;
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .error-message, .success-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message {
            background: var(--ardentes-red);
            color: white;
        }

        .success-message {
            background: var(--spotify-green);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .reset-btn {
            background: var(--ardentes-orange);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            background: var(--ardentes-red);
            transform: translateY(-2px);
        }

        footer {
            text-align: center;
            padding: 20px 0;
            color: var(--text-muted);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: auto;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 30px 20px;
            }
            
            .artists-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
        }

        .copy-btn {
            background: var(--ardentes-orange);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 10px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎵 Spotify x Les Ardentes 2025</h1>
            <p>Découvre quels artistes de tes likes sont au festival !</p>
            <div class="github-badge">Version Netlify 🚀</div>
        </header>

        <main>
            <!-- Section de configuration -->
            <div id="setup-section" class="section">
                <div class="card">
                    <h2>🚀 Configuration en ligne</h2>
                    <p>Configure une seule fois, puis partage avec tout le monde !</p>
                    
                    <div class="setup-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <strong>URL de l'app</strong><br>
                            Cette app est hébergée sur :<br>
                            <div class="url-display" id="current-url-display"></div>
                        </div>
                    </div>

                    <div class="setup-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <strong>Configuration Spotify</strong><br>
                            Va sur <a href="https://developer.spotify.com/dashboard" target="_blank" style="color: var(--spotify-green);">developer.spotify.com/dashboard</a><br>
                            Utilise cette URL comme Redirect URI :<br>
                            <div class="url-display" id="redirect-url">
                                <span id="current-url"></span>
                                <button class="copy-btn" onclick="copyUrl()">Copier</button>
                            </div>
                        </div>
                    </div>

                    <div class="setup-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <strong>Client ID Spotify</strong><br>
                            Colle ton Client ID ici :<br>
                            <input type="text" id="client-id-input" class="client-id-input" 
                                   placeholder="Colle ton Client ID Spotify ici...">
                        </div>
                    </div>

                    <button id="connect-btn" class="spotify-btn" disabled>
                        <span>🎧</span>
                        Se connecter avec Spotify
                    </button>
                    
                    <div style="margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                        🔒 Tes données restent privées et ne sont jamais sauvegardées
                    </div>
                </div>
            </div>

            <!-- Section de chargement -->
            <div id="loading-section" class="section hidden">
                <div class="card">
                    <div class="spinner"></div>
                    <h2>Analyse en cours...</h2>
                    <p>Récupération de tes likes et comparaison avec les artistes des Ardentes 2025</p>
                </div>
            </div>

            <!-- Section des résultats -->
            <div id="results-section" class="section hidden">
                <div class="card">
                    <h2>🎉 Tes artistes des Ardentes 2025</h2>
                    <div id="user-info" class="user-info"></div>
                    <div id="stats-container"></div>
                    <div id="matching-artists" class="artists-grid"></div>
                    
                    <div class="action-buttons">
                        <button id="share-btn" class="spotify-btn">📱 Partager</button>
                        <button id="reset-btn" class="reset-btn">🔄 Recommencer</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Créé avec ❤️ pour les fans des Ardentes | Données Spotify via l'API officielle</p>
            <p style="font-size: 0.8rem;">🌐 Hébergé sur Netlify - Pas de serveur requis</p>
        </footer>
    </div>

    <script>
        // Configuration - URL automatique
        const CONFIG = {
            CLIENT_ID: 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY',
            REDIRECT_URI: window.location.href.split('?')[0].split('#')[0],
            SCOPES: 'user-library-read user-read-private'
        };

        // Liste des artistes des Ardentes 2025 (50+ artistes)
        const ARDENTES_ARTISTS = [
            'Tiësto', 'David Guetta', 'Calvin Harris', 'Marshmello', 'The Chainsmokers',
            'Dua Lipa', 'Doja Cat', 'Tyler, The Creator', 'Travis Scott', 'Future',
            'Central Cee', 'Skepta', 'Dave', 'Stormzy', 'AJ Tracey',
            'Booba', 'PNL', 'Orelsan', 'Stromae', 'Angèle',
            'Charlotte de Witte', 'Amelie Lens', 'Nina Kraviz', 'Tale of Us', 'Maceo Plex',
            'Arctic Monkeys', 'Tame Impala', 'Glass Animals', 'The 1975', 'Foals',
            'Bad Bunny', 'Rosalía', 'J Balvin', 'Ozuna', 'Karol G',
            'Billie Eilish', 'Lorde', 'Clairo', 'Phoebe Bridgers', 'Lana Del Rey',
            'Disclosure', 'ODESZA', 'Flume', 'Porter Robinson', 'Madeon',
            'Burna Boy', 'Wizkid', 'Davido', 'Tems', 'Amaarae',
            'Diplo', 'Skrillex', 'Major Lazer', 'Zedd', 'Alesso'
        ];

        // Variables globales
        let accessToken = null;
        let userProfile = null;
        let userTracks = [];
        let matchingArtists = [];

        // Éléments DOM
        const setupSection = document.getElementById('setup-section');
        const loadingSection = document.getElementById('loading-section');
        const resultsSection = document.getElementById('results-section');
        const clientIdInput = document.getElementById('client-id-input');
        const connectBtn = document.getElementById('connect-btn');
        const resetBtn = document.getElementById('reset-btn');
        const shareBtn = document.getElementById('share-btn');

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // Afficher l'URL actuelle
            document.getElementById('current-url').textContent = CONFIG.REDIRECT_URI;
            document.getElementById('current-url-display').textContent = CONFIG.REDIRECT_URI;

            // Vérifier si on revient de Spotify
            const hash = window.location.hash.substr(1);
            if (hash) {
                const params = new URLSearchParams(hash);
                accessToken = params.get('access_token');
                CONFIG.CLIENT_ID = localStorage.getItem('spotify_client_id');
                
                if (accessToken && CONFIG.CLIENT_ID && CONFIG.CLIENT_ID !== 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY') {
                    window.history.replaceState({}, document.title, window.location.pathname);
                    startAnalysis();
                    return;
                }
            }

            // Charger le Client ID sauvegardé
            const savedClientId = localStorage.getItem('spotify_client_id');
            if (savedClientId && savedClientId !== 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY') {
                clientIdInput.value = savedClientId;
                CONFIG.CLIENT_ID = savedClientId;
                connectBtn.disabled = false;
            }

            // Gestion de l'input Client ID
            clientIdInput.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                CONFIG.CLIENT_ID = value;
                connectBtn.disabled = !value || value === 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY';
                
                if (value && value !== 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY') {
                    localStorage.setItem('spotify_client_id', value);
                }
            });

            // Bouton de connexion
            connectBtn.addEventListener('click', () => {
                if (!CONFIG.CLIENT_ID || CONFIG.CLIENT_ID === 'REMPLACE_PAR_TON_CLIENT_ID_SPOTIFY') {
                    showError('Veuillez entrer un Client ID Spotify valide');
                    return;
                }
                loginToSpotify();
            });

            // Bouton reset
            resetBtn.addEventListener('click', () => {
                showSection('setup');
            });

            // Bouton partage
            shareBtn.addEventListener('click', () => {
                shareResults();
            });
        });

        function loginToSpotify() {
            const authUrl = `https://accounts.spotify.com/authorize?` +
                `client_id=${CONFIG.CLIENT_ID}&` +
                `response_type=token&` +
                `redirect_uri=${encodeURIComponent(CONFIG.REDIRECT_URI)}&` +
                `scope=${encodeURIComponent(CONFIG.SCOPES)}&` +
                `show_dialog=true`;
            
            window.location.href = authUrl;
        }

        async function startAnalysis() {
            showSection('loading');
            
            try {
                userProfile = await getUserProfile();
                userTracks = await getAllUserTracks();
                matchingArtists = findMatchingArtists();
                displayResults();
                showMessage('✅ Analyse terminée avec succès !');
            } catch (error) {
                console.error('Erreur:', error);
                showError('Erreur lors de l\'analyse. Vérifiez votre Client ID.');
                showSection('setup');
            }
        }

        async function getUserProfile() {
            const response = await fetch('https://api.spotify.com/v1/me', {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            
            if (!response.ok) {
                throw new Error('Erreur API Spotify');
            }
            
            return await response.json();
        }

        async function getAllUserTracks() {
            let allTracks = [];
            let url = 'https://api.spotify.com/v1/me/tracks?limit=50';
            
            while (url && allTracks.length < 1000) {
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                
                if (!response.ok) break;
                
                const data = await response.json();
                allTracks = allTracks.concat(data.items);
                url = data.next;
                
                // Délai pour éviter le rate limiting
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            return allTracks;
        }

        function findMatchingArtists() {
            const userArtists = new Set();
            
            userTracks.forEach(item => {
                if (item.track?.artists) {
                    item.track.artists.forEach(artist => {
                        userArtists.add(artist.name.toLowerCase());
                    });
                }
            });

            return ARDENTES_ARTISTS.filter(artist => 
                userArtists.has(artist.toLowerCase())
            ).map(artist => ({
                name: artist,
                tracks: userTracks.filter(item => 
                    item.track?.artists?.some(a => 
                        a.name.toLowerCase() === artist.toLowerCase()
                    )
                ).slice(0, 3)
            }));
        }

        function displayResults() {
            showSection('results');

            // Info utilisateur
            document.getElementById('user-info').innerHTML = `
                <div class="user-avatar">🎵</div>
                <div>
                    <h3>Salut ${userProfile.display_name || 'Utilisateur'} ! 👋</h3>
                    <p>${userTracks.length} likes analysés</p>
                </div>
            `;

            // Statistiques
            const statsHtml = `
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number">${matchingArtists.length}</div>
                        <div class="stat-label">Artistes trouvés</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">${userTracks.length}</div>
                        <div class="stat-label">Likes analysés</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">${Math.round((matchingArtists.length / ARDENTES_ARTISTS.length) * 100)}%</div>
                        <div class="stat-label">Du festival découvert</div>
                    </div>
                </div>
            `;
            document.getElementById('stats-container').innerHTML = statsHtml;

            // Artistes correspondants
            const artistsGrid = document.getElementById('matching-artists');
            if (matchingArtists.length === 0) {
                artistsGrid.innerHTML = `
                    <div class="no-matches">
                        <h3>🎵 Nouveaux horizons musicaux !</h3>
                        <p>Tu n'as pas encore découvert ces artistes des Ardentes 2025.</p>
                        <p>C'est l'occasion parfaite d'élargir tes goûts ! 🚀</p>
                        <p style="margin-top: 20px; font-size: 0.9rem;">
                            Découvre: ${ARDENTES_ARTISTS.slice(0, 5).join(', ')}...
                        </p>
                    </div>
                `;
            } else {
                artistsGrid.innerHTML = matchingArtists.map(artist => `
                    <div class="artist-match fade-in">
                        <h4>🎤 ${artist.name}</h4>
                        <p><strong>${artist.tracks.length}</strong> chanson${artist.tracks.length > 1 ? 's' : ''}</p>
                        <p style="font-size: 0.9rem; opacity: 0.9;">
                            ${artist.tracks.map(item => item.track.name).slice(0, 2).join(', ')}
                        </p>
                    </div>
                `).join('');
            }
        }

        function shareResults() {
            const text = matchingArtists.length > 0 
                ? `🎵 J'ai trouvé ${matchingArtists.length} artistes des Ardentes 2025 dans mes likes Spotify ! Découvre les tiens :`
                : `🎵 J'ai analysé mes likes pour les Ardentes 2025 ! Découvre tes artistes :`;
            
            const url = window.location.href.split('#')[0];
            
            if (navigator.share) {
                navigator.share({
                    title: 'Spotify x Ardentes 2025',
                    text: text,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(`${text} ${url}`).then(() => {
                    showMessage('Lien copié dans le presse-papiers ! 📋');
                }).catch(() => {
                    showMessage(`Partage ce lien : ${url}`);
                });
            }
        }

        function copyUrl() {
            const url = document.getElementById('current-url').textContent;
            navigator.clipboard.writeText(url).then(() => {
                showMessage('URL copiée ! 📋');
            }).catch(() => {
                showMessage('Copie cette URL manuellement');
            });
        }

        function showSection(section) {
            [setupSection, loadingSection, resultsSection].forEach(el => {
                el.classList.add('hidden');
            });
            
            switch(section) {
                case 'setup': setupSection.classList.remove('hidden'); break;
                case 'loading': loadingSection.classList.remove('hidden'); break;
                case 'results': resultsSection.classList.remove('hidden'); break;
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('main'));
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.textContent = message;
            document.querySelector('.container').insertBefore(messageDiv, document.querySelector('main'));
            setTimeout(() => messageDiv.remove(), 3000);
        }
    </script>
</body>
</html> 